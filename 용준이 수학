<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìˆ˜í•™ í›„ì†íƒêµ¬: ì‹œì„ ì†ë„ ë¶„ì„ (Final)</title>
    <style>
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: #1a1a2e; color: #e0e0e0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; overflow-x: hidden; position: relative;
            background-image: radial-gradient(circle at 20% 30%, rgba(41, 128, 185, 0.2) 0%, transparent 50%),
                              radial-gradient(circle at 80% 70%, rgba(231, 76, 60, 0.2) 0%, transparent 50%);
        }

        /* ì›Œí„°ë§ˆí¬ */
        .watermark {
            position: absolute; top: 20px; right: 25px;
            font-size: 20px; font-weight: bold;
            color: rgba(255, 255, 255, 0.3); pointer-events: none; z-index: 10;
        }

        /* --- í† ìŠ¤íŠ¸ ì•Œë¦¼ --- */
        .toast-notification {
            position: fixed; top: -80px; left: 50%; transform: translateX(-50%);
            background: rgba(39, 174, 96, 0.95); color: white;
            padding: 15px 30px; border-radius: 30px;
            font-weight: bold; font-size: 16px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2000; display: flex; align-items: center; gap: 10px;
        }
        .toast-notification.show { top: 30px; }

        /* --- ë²„íŠ¼ ê·¸ë£¹ --- */
        .btn-container {
            position: absolute; top: 20px; left: 20px;
            display: flex; flex-direction: column; gap: 10px; z-index: 20;
        }
        .guide-btn {
            background-color: #f39c12; color: white;
            padding: 12px 18px; border: none; border-radius: 12px; font-size: 15px;
            font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: 0.2s; text-align: left; width: 240px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .guide-btn:hover { background-color: #e67e22; transform: translateY(-2px); }
        .guide-btn span { font-size: 18px; }
        .ex-btn { background-color: #2980b9; }
        .ex-btn:hover { background-color: #3498db; }

        /* --- ëª¨ë‹¬ íŒì—… --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 100;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; color: #333; width: 650px; padding: 30px;
            border-radius: 20px; position: relative; line-height: 1.6;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            max-height: 85vh; overflow-y: auto;
        }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; font-weight:bold; color: #777;}
        .close-btn:hover { color: #333; }

        /* í–‰ì„± ì¹´ë“œ */
        .planet-card {
            background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;
            border: 1px solid #ddd; display: flex; gap: 20px; align-items: center;
            transition: 0.2s;
        }
        .planet-card:hover { transform: scale(1.01); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .planet-img {
            width: 100px; height: 100px; border-radius: 10px; object-fit: cover; background: #eee;
            border: 2px solid #ddd;
        }
        .planet-info { flex: 1; }
        .planet-title { font-weight: bold; color: #2c3e50; font-size: 18px; margin-bottom: 5px; }
        .apply-btn {
            background: #27ae60; color: white; border: none; padding: 8px 16px;
            border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold;
            margin-top: 10px; float: right; transition: 0.2s;
        }
        .apply-btn:hover { background: #2ecc71; }

        /* íƒ€ì´í‹€ */
        h1 { margin-bottom: 5px; color: #fff; text-shadow: 0 0 15px #4b7bec; font-size: 34px; margin-top: 30px;}
        .subtitle { color: #bdc3c7; font-size: 16px; margin-bottom: 25px; }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-layout { display: flex; gap: 25px; align-items: stretch; justify-content: center; flex-wrap: wrap;}

        /* íŒ¨ë„ ê³µí†µ */
        .panel {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 20px; border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex; flex-direction: column; align-items: center;
            backdrop-filter: blur(5px); box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        canvas {
            background-color: #0f0f1a; border-radius: 12px;
            border: 2px solid #34495e; box-shadow: inset 0 0 20px #000;
        }
        .label { margin-top: 10px; font-weight: bold; color: #4b7bec; font-size: 15px; }

        /* ìŠ¤í™íŠ¸ëŸ¼ */
        .spectrum-container {
            width: 100%; height: 50px; margin-top: 10px;
            background: linear-gradient(to right, #4b0082, #0000ff, #00ff00, #ffff00, #ff7f00, #ff0000);
            border-radius: 8px; position: relative; border: 2px solid #333; overflow: hidden;
        }
        .absorption-line {
            position: absolute; top: 0; bottom: 0; width: 3px; background-color: rgba(0,0,0,0.8);
            left: 50%; box-shadow: 0 0 5px rgba(255,255,255,0.8);
        }
        .spectrum-label { display: flex; justify-content: space-between; width: 100%; font-size: 12px; color: #aaa; margin-top: 5px; }

        /* ìˆ˜í•™ íŒ¨ë„ */
        .math-panel { width: 300px; gap: 12px; justify-content: space-between; }
        .data-box {
            width: 100%; box-sizing: border-box;
            background: rgba(0, 0, 0, 0.4); padding: 15px; border-radius: 12px; border-left: 5px solid #4b7bec;
        }
        .data-title-small { font-size: 12px; color: #bbb; margin-bottom: 5px; }
        .data-value { font-size: 20px; font-weight: bold; font-family: 'Courier New', monospace; }
        .slope-bar-bg { height: 6px; background: #333; width: 100%; margin-top: 10px; position: relative; border-radius: 3px; overflow: hidden;}
        .slope-bar { height: 100%; background: #fc5c65; width: 0%; position: absolute; left: 50%; }
        .highlight-text { color: #fed330; font-weight: bold; font-size: 15px; min-height: 45px; display: flex; align-items: center; justify-content: center; text-align: center; line-height: 1.4;}
        
        /* ë„í”ŒëŸ¬ ì„¤ëª… ë°•ìŠ¤ */
        .doppler-info-box {
            background: rgba(52, 73, 94, 0.6); border-left-color: #f39c12;
        }
        .doppler-info-text { font-size: 13px; color: #ecf0f1; line-height: 1.5; }
        .color-sample { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px; }

        /* ì»¨íŠ¸ë¡¤ ì˜ì—­ */
        .controls { 
            margin-top: 25px; display: flex; gap: 40px; align-items: center; 
            background: rgba(255,255,255,0.05); padding: 15px 40px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 30px;
        }
        button.ctrl-btn {
            padding: 12px 24px; background-color: #3867d6; color: white; border: none;
            border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 16px;
            box-shadow: 0 4px 0 #2c3a47;
        }
        button.ctrl-btn:hover { background-color: #4b7bec; transform: translateY(2px); box-shadow: 0 2px 0 #2c3a47; }
        .slider-group { display: flex; flex-direction: column; gap: 8px; color: #ecf0f1; font-size: 14px; text-align: center; font-weight: bold;}
        
        input[type=range] {
            -webkit-appearance: none; width: 180px; height: 8px;
            background: #4b6584; border-radius: 5px; outline: none; transition: 0.2s;
        }
        input[type=range]:hover { background: #778ca3; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 22px; height: 22px; border-radius: 50%; 
            background: #3867d6; border: 2px solid #fff; cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.5); transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }
    </style>
</head>
<body>

    <div class="watermark">20306ê¹€ìš©ì¤€</div>

    <div id="toast" class="toast-notification">
        <span>âœ…</span> <span id="toast-msg">ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
    </div>

    <div class="btn-container">
        <button class="guide-btn" onclick="openModal('conceptModal')">
            ğŸ“– ì§€êµ¬ê³¼í•™â…  ê°œë… ê°€ì´ë“œ <span>â€º</span>
        </button>
        <button class="guide-btn ex-btn" onclick="openModal('exModal')">
            ğŸª ì‹¤ì œ ì™¸ê³„í–‰ì„± ì˜ˆì‹œ <span>â€º</span>
        </button>
    </div>

    <div id="conceptModal" class="modal-overlay" onclick="closeModalOutside(event, 'conceptModal')">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('conceptModal')">&times;</span>
            <h2 style="border-bottom:2px solid #ddd; padding-bottom:10px; color:#2c3e50;">ğŸŒ ì‹œì„ ì†ë„ ë¶„ì„ í•µì‹¬ ê°œë…</h2>
            <h3 style="color:#2980b9">1. ìŠ¤í™íŠ¸ëŸ¼ê³¼ ë„í”ŒëŸ¬ íš¨ê³¼</h3>
            <p>í™”ë©´ ê°€ìš´ë° ìˆëŠ” ë¬´ì§€ê°œ ë (ìŠ¤í™íŠ¸ëŸ¼)ë¥¼ ë³´ì„¸ìš”.<br>
            â€¢ <b>ì²­ìƒ‰í¸ì´ (Blue Shift):</b> ë³„ì´ ë‹¤ê°€ì˜¬ ë•Œ í¡ìˆ˜ì„ ì´ <b>ì™¼ìª½(íŒŒë€ìƒ‰)</b>ìœ¼ë¡œ ì´ë™.<br>
            â€¢ <b>ì ìƒ‰í¸ì´ (Red Shift):</b> ë³„ì´ ë©€ì–´ì§ˆ ë•Œ í¡ìˆ˜ì„ ì´ <b>ì˜¤ë¥¸ìª½(ë¹¨ê°„ìƒ‰)</b>ìœ¼ë¡œ ì´ë™.</p>
            <h3 style="color:#2980b9">2. ì§ˆëŸ‰ ì¤‘ì‹¬ (Barycenter)</h3>
            <p>ì™¼ìª½ í™”ë©´ ì¤‘ì•™ì˜ <b>í°ìƒ‰ ì‹­ìê°€(+)</b>ê°€ ê³µí†µ ì§ˆëŸ‰ ì¤‘ì‹¬ì…ë‹ˆë‹¤. í–‰ì„±ë§Œ ë„ëŠ” ê²Œ ì•„ë‹ˆë¼, <b>ë³„ë„ ì´ ì ì„ ì¤‘ì‹¬ìœ¼ë¡œ ê³µì „</b>í•˜ê¸° ë•Œë¬¸ì— ì‹œì„ ì†ë„ ë³€í™”ê°€ ìƒê¹ë‹ˆë‹¤.</p>
        </div>
    </div>

    <div id="exModal" class="modal-overlay" onclick="closeModalOutside(event, 'exModal')">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('exModal')">&times;</span>
            <h2 style="border-bottom:2px solid #2980b9; padding-bottom:10px; color:#2980b9;">ğŸª ì‹¤ì œ ì™¸ê³„í–‰ì„± ë°ì´í„° ì²´í—˜</h2>
            
            <div class="planet-card">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/51_Pegasi_b.png/320px-51_Pegasi_b.png" class="planet-img" alt="51 Pegasi b" crossorigin="anonymous">
                <div class="planet-info">
                    <div class="planet-title">1. 51 Pegasi b (í˜ê°€ìˆ˜ìŠ¤ìë¦¬)</div>
                    <p style="font-size:13px; color:#555; margin:0;">ìµœì´ˆ ë°œê²¬ëœ 'ëœ¨ê±°ìš´ ëª©ì„±'. ê³µì „ ì£¼ê¸°ê°€ 4ì¼ë¡œ ë§¤ìš° ì§§ê³  ì§ˆëŸ‰ì´ ì»¤ì„œ ë³„ì´ ì‹¬í•˜ê²Œ í”ë“¤ë¦¼.</p>
                    <button class="apply-btn" onclick="setPreset(80, 0.03, '51 Pegasi b ì ìš©ë¨! ğŸš€')">ì ìš©í•˜ê¸°</button>
                </div>
            </div>

            <div class="planet-card">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Proxima_Centauri_b_artist_impression.jpg/320px-Proxima_Centauri_b_artist_impression.jpg" class="planet-img" alt="Proxima b" crossorigin="anonymous">
                <div class="planet-info">
                    <div class="planet-title">2. Proxima Centauri b (í”„ë¡ì‹œë§ˆ)</div>
                    <p style="font-size:13px; color:#555; margin:0;">ì§€êµ¬ì™€ ê°€ì¥ ê°€ê¹Œìš´ ì™¸ê³„í–‰ì„±. ì§€êµ¬ì™€ ë¹„ìŠ·í•œ ì§ˆëŸ‰. ê³µì „ ì£¼ê¸° ì•½ 11ì¼. í”ë“¤ë¦¼ì´ ë¹„êµì  ì‘ìŒ.</p>
                    <button class="apply-btn" onclick="setPreset(30, 0.012, 'Proxima b ì ìš©ë¨! ğŸŒ')">ì ìš©í•˜ê¸°</button>
                </div>
            </div>

            <div class="planet-card">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ed/HD_209458_b.jpg/320px-HD_209458_b.jpg" class="planet-img" alt="Osiris" crossorigin="anonymous">
                <div class="planet-info">
                    <div class="planet-title">3. HD 209458 b (ì˜¤ì‹œë¦¬ìŠ¤)</div>
                    <p style="font-size:13px; color:#555; margin:0;">ìµœì´ˆë¡œ 'ì‹ í˜„ìƒ'ì´ ê´€ì¸¡ëœ ê±°ëŒ€ ê°€ìŠ¤ í–‰ì„±. ë§¤ìš° ëšœë ·í•œ ì‹œì„ ì†ë„ ë³€í™”ë¥¼ ë³´ì„.</p>
                    <button class="apply-btn" onclick="setPreset(60, 0.02, 'Osiris ì ìš©ë¨! â˜„ï¸')">ì ìš©í•˜ê¸°</button>
                </div>
            </div>
            <p style="font-size:12px; color:#999; text-align:center; margin-top:10px;">* ì´ë¯¸ì§€ ì¶œì²˜: Wikimedia Commons (ì¸í„°ë„· ì—°ê²° í•„ìš”)</p>
        </div>
    </div>

    <h1>ìˆ˜í•™ í›„ì†íƒêµ¬</h1>
    <p class="subtitle">ë„í•¨ìˆ˜, ìŠ¤í™íŠ¸ëŸ¼, ì‹¤ì œ ë°ì´í„°ë¥¼ í†µí•œ ì‹¬ì¸µ ë¶„ì„ ì‹œë®¬ë ˆì´í„°</p>

    <div class="main-layout">
        <div class="panel">
            <canvas id="orbitCanvas" width="280" height="280"></canvas>
            <div class="label">ê³µí†µ ì§ˆëŸ‰ ì¤‘ì‹¬ íšŒì „ (Top View)</div>
        </div>

        <div class="panel math-panel">
            <div style="width:100%">
                <div class="label" style="text-align:left; margin-bottom:5px;">ğŸŒˆ ìŠ¤í™íŠ¸ëŸ¼ ë³€ì´ (Doppler Shift)</div>
                <div class="spectrum-container">
                    <div id="line1" class="absorption-line" style="left: 30%;"></div>
                    <div id="line2" class="absorption-line" style="left: 50%;"></div>
                    <div id="line3" class="absorption-line" style="left: 70%;"></div>
                </div>
                <div class="spectrum-label">
                    <span>â—€ ì²­ìƒ‰í¸ì´ (Blue)</span>
                    <span>ì ìƒ‰í¸ì´ (Red) â–¶</span>
                </div>
            </div>

            <div class="data-box">
                <div class="data-title-small">í•¨ìˆ˜ê°’ v(t) = A sin(Ï‰t)</div>
                <div class="data-value" id="val-v">0.00 km/s</div>
            </div>

            <div class="data-box" style="border-left-color: #fc5c65;">
                <div class="data-title-small">ë¯¸ë¶„ê°’ v'(t) â‰ˆ ê°€ì†ë„</div>
                <div class="data-value" id="val-slope">0.00</div>
                <div class="slope-bar-bg"><div id="slope-bar" class="slope-bar"></div></div>
            </div>

            <div class="data-box doppler-info-box">
                <div class="data-title-small" style="color:#f39c12; font-weight:bold;">ğŸ’¡ ì™œ ë³„ì˜ ìƒ‰ì´ ë³€í• ê¹Œ?</div>
                <div class="doppler-info-text">
                    <div><span class="color-sample" style="background:#4d4dff;"></span><b>ë‹¤ê°€ì˜¬ ë•Œ:</b> íŒŒì¥ì´ ì••ì¶•ë˜ì–´ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³´ì„ (ì²­ìƒ‰í¸ì´)</div>
                    <div style="margin-top:5px;"><span class="color-sample" style="background:#ff4d4d;"></span><b>ë©€ì–´ì§ˆ ë•Œ:</b> íŒŒì¥ì´ ëŠ˜ì–´ë‚˜ì„œ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³´ì„ (ì ìƒ‰í¸ì´)</div>
                    <div style="font-size:11px; color:#aaa; margin-top:5px;">*ì‹œê°ì  ì´í•´ë¥¼ ìœ„í•´ ê³¼ì¥ëœ í‘œí˜„ì…ë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <canvas id="graphCanvas" width="380" height="280"></canvas>
            <div class="label">ì‹œì„ ì†ë„ ê·¸ë˜í”„ v(t)ì™€ ì ‘ì„ </div>
        </div>
    </div>

    <div class="controls">
        <button class="ctrl-btn" id="btn-pause" onclick="togglePause()">ì¼ì‹œ ì •ì§€ â¸</button>
        
        <div class="slider-group">
            <label>í–‰ì„± ì§ˆëŸ‰ (ì§„í­ A)</label>
            <input type="range" id="amp-slider" min="20" max="80" value="50">
        </div>
        
        <div class="slider-group">
            <label>ê³µì „ ì†ë„ (ì£¼ê¸° T)</label>
            <input type="range" id="freq-slider" min="1" max="10" step="1" value="3">
        </div>
    </div>

    <script>
        const orbitCanvas = document.getElementById('orbitCanvas');
        const orbitCtx = orbitCanvas.getContext('2d');
        const graphCanvas = document.getElementById('graphCanvas');
        const graphCtx = graphCanvas.getContext('2d');

        // --- ëª¨ë‹¬ ì œì–´ ---
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function closeModalOutside(e, id) { if(e.target.id === id) closeModal(id); }

        // --- í† ìŠ¤íŠ¸ ì•Œë¦¼ ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            const msgSpan = document.getElementById('toast-msg');
            msgSpan.innerText = message;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }

        // --- ë³€ìˆ˜ ë° ì„¤ì • ---
        let time = 0;
        let isPaused = false;
        let pathData = []; 
        let amplitude = 50; 
        let frequency = 0.01; 

        const ampSlider = document.getElementById('amp-slider');
        const freqSlider = document.getElementById('freq-slider');

        ampSlider.addEventListener('input', (e) => {
            amplitude = parseInt(e.target.value);
            pathData = []; 
        });
        freqSlider.addEventListener('input', (e) => {
            frequency = parseFloat(e.target.value) * 0.003; 
        });

        // --- í”„ë¦¬ì…‹ ì ìš© ---
        function setPreset(amp, freqScale, msg) {
            amplitude = amp;
            frequency = freqScale;
            pathData = []; 
            time = 0; 
            ampSlider.value = amp;
            freqSlider.value = Math.min(10, Math.max(1, freqScale / 0.003)); 
            closeModal('exModal');
            showToast(msg);
        }

        function togglePause() {
            isPaused = !isPaused;
            document.getElementById('btn-pause').innerText = isPaused ? "ë‹¤ì‹œ ì‹œì‘ â–¶" : "ì¼ì‹œ ì •ì§€ â¸";
        }

        function animate() {
            if (!isPaused) {
                time += frequency;
                updatePhysics();
            }
            drawOrbit();
            drawGraph();
            requestAnimationFrame(animate);
        }

        function updatePhysics() {
            const rawVal = Math.sin(time);
            const v_val = amplitude * rawVal; 
            const slope_val = Math.cos(time); 

            document.getElementById('val-v').innerText = v_val.toFixed(2) + " km/s";
            let slopeText = slope_val.toFixed(2);
            if(Math.abs(slope_val) < 0.05) slopeText = "0 (ê·¹ê°’)";
            document.getElementById('val-slope').innerText = slopeText;

            const bar = document.getElementById('slope-bar');
            const barWidth = Math.abs(slope_val) * 50;
            bar.style.width = barWidth + "%";
            if (slope_val > 0) {
                bar.style.left = "50%"; bar.style.background = "#fc5c65"; 
            } else {
                bar.style.left = (50 - barWidth) + "%"; bar.style.background = "#45aaf2"; 
            }

            const shiftAmount = (v_val / 3.5); 
            document.getElementById('line1').style.left = `calc(30% + ${shiftAmount}px)`;
            document.getElementById('line2').style.left = `calc(50% + ${shiftAmount}px)`;
            document.getElementById('line3').style.left = `calc(70% + ${shiftAmount}px)`;

            pathData.push({ t: time, v: v_val, slope: slope_val });
            if (pathData.length > 400) pathData.shift(); 
        }

        function drawOrbit() {
            orbitCtx.clearRect(0, 0, 280, 280);
            const cx = 140, cy = 140;
            
            orbitCtx.strokeStyle = "rgba(255, 255, 255, 0.6)"; orbitCtx.lineWidth = 2;
            orbitCtx.beginPath(); orbitCtx.moveTo(cx-8, cy); orbitCtx.lineTo(cx+8, cy); orbitCtx.stroke();
            orbitCtx.beginPath(); orbitCtx.moveTo(cx, cy-8); orbitCtx.lineTo(cx, cy+8); orbitCtx.stroke();
            orbitCtx.fillStyle = "#fff"; orbitCtx.font="10px Arial"; orbitCtx.fillText("CM", cx+5, cy-5);

            const r_star = amplitude * 0.6; 
            const r_planet = 90;

            let x_s = cx + r_star * Math.cos(time);
            let y_s = cy - r_star * Math.sin(time); 
            let x_p = cx - r_planet * Math.cos(time);
            let y_p = cy + r_planet * Math.sin(time);

            orbitCtx.strokeStyle = "rgba(255,255,255,0.1)"; orbitCtx.lineWidth = 1;
            orbitCtx.beginPath(); orbitCtx.arc(cx, cy, r_star, 0, Math.PI*2); orbitCtx.stroke();
            orbitCtx.beginPath(); orbitCtx.arc(cx, cy, r_planet, 0, Math.PI*2); orbitCtx.stroke();

            // ë¶€ë“œëŸ¬ìš´ ë³„ ìƒ‰ìƒ
            const velocity = Math.sin(time);
            let r, g, b;
            if (velocity < 0) { 
                const ratio = Math.abs(velocity); 
                r = Math.floor(255 * (1 - ratio) + 80 * ratio);
                g = Math.floor(255 * (1 - ratio) + 80 * ratio);
                b = 255;
            } else { 
                const ratio = velocity;
                r = 255;
                g = Math.floor(255 * (1 - ratio) + 80 * ratio);
                b = Math.floor(255 * (1 - ratio) + 80 * ratio);
            }
            const starColor = `rgb(${r},${g},${b})`;
            
            orbitCtx.beginPath(); orbitCtx.arc(x_s, y_s, 14, 0, Math.PI*2);
            orbitCtx.fillStyle = starColor;
            orbitCtx.shadowBlur = 10 + Math.abs(velocity) * 15; orbitCtx.shadowColor = starColor;
            orbitCtx.fill(); orbitCtx.shadowBlur = 0;

            const planetRadius = 4 + (amplitude / 8); 
            orbitCtx.beginPath(); orbitCtx.arc(x_p, y_p, planetRadius, 0, Math.PI*2);
            orbitCtx.fillStyle = "#bdc3c7"; orbitCtx.fill();
            
            orbitCtx.fillStyle = "white"; orbitCtx.font = "12px sans-serif";
            orbitCtx.fillText("ğŸ‘ï¸ ê´€ì¸¡ì (ì§€êµ¬)", cx-40, 270);
            orbitCtx.beginPath(); orbitCtx.moveTo(cx, 255); orbitCtx.lineTo(cx, 245); orbitCtx.stroke();
        }

        function drawGraph() {
            // ì”ìƒ íš¨ê³¼
            graphCtx.fillStyle = 'rgba(15, 15, 26, 0.15)';
            graphCtx.fillRect(0, 0, 380, 280);
            
            const gw = 380, gh = 280; const cy = gh / 2;
            
            graphCtx.strokeStyle = "#555";
            graphCtx.beginPath(); graphCtx.moveTo(0, cy); graphCtx.lineTo(gw, cy); graphCtx.stroke();

            // ì¶• ë¼ë²¨ ì¶”ê°€ (NEW)
            graphCtx.fillStyle = "#aaa";
            graphCtx.font = "11px sans-serif";
            graphCtx.fillText("ì‹œê°„ (t) â†’", gw - 50, cy + 15);
            graphCtx.fillText("â†‘ ì‹œì„ ì†ë„ v (km/s)", 10, 20);

            if (pathData.length < 2) return;

            graphCtx.beginPath();
            const x_offset = gw - 50;
            
            for (let i = 0; i < pathData.length; i++) {
                let pt = pathData[i];
                let indexFromEnd = pathData.length - 1 - i;
                let x = x_offset - (indexFromEnd * 0.85); 
                let y = cy - pt.v; 
                if (x < 0) continue;
                if (i === 0 || (x_offset - (pathData.length - i)*0.85) < 0) graphCtx.moveTo(x, y);
                else graphCtx.lineTo(x, y);
            }
            graphCtx.strokeStyle = "#ecf0f1"; graphCtx.lineWidth = 2; graphCtx.stroke();

            let lastPt = pathData[pathData.length - 1];
            let curX = x_offset; let curY = cy - lastPt.v;

            graphCtx.beginPath(); graphCtx.arc(curX, curY, 5, 0, Math.PI*2);
            graphCtx.fillStyle = "#fed330"; graphCtx.fill();

            const slope = -lastPt.slope; 
            let dx = 30; let dy = dx * slope;
            graphCtx.beginPath(); graphCtx.moveTo(curX - dx, curY - dy); graphCtx.lineTo(curX + dx, curY + dy);
            graphCtx.strokeStyle = "#fc5c65"; graphCtx.lineWidth = 3; graphCtx.stroke();
        }

        animate();
    </script>
</body>
</html>
